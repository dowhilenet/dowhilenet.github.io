

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Core Data的增删查改 | 这块显卡有点冷</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="baidu-site-verification" content="1ZsVVOmjoT" />
    <meta name="description" content="初始化方法一创建一个iOS工程，勾选Use Core Data。
工程创建完后，XCode将为我们生成一个xcdatamodeld文件用于创建实体。我们可以在这里编辑实体，并产生托管对象类。同时，XCode也在AppDelegate.Swift中添加了一些用于支持CoreData的代码。
我在这里所用的办法是通过辅助类来设置Core Data，这样的话，你就可以将这种办法运用到自己的项目中了。这也">
<meta property="og:type" content="article">
<meta property="og:title" content="Core Data的增删查改">
<meta property="og:url" content="http://dowhile.net/2015/06/04/coredata2/index.html">
<meta property="og:site_name" content="这块显卡有点冷">
<meta property="og:description" content="初始化方法一创建一个iOS工程，勾选Use Core Data。
工程创建完后，XCode将为我们生成一个xcdatamodeld文件用于创建实体。我们可以在这里编辑实体，并产生托管对象类。同时，XCode也在AppDelegate.Swift中添加了一些用于支持CoreData的代码。
我在这里所用的办法是通过辅助类来设置Core Data，这样的话，你就可以将这种办法运用到自己的项目中了。这也">
<meta property="og:image" content="http://7u2j0x.com1.z0.glb.clouddn.com/QQ20150604-1@2x.png">
<meta property="og:image" content="http://7u2j0x.com1.z0.glb.clouddn.com/QQ20150604-2@2x.png">
<meta property="og:updated_time" content="2015-06-29T04:51:49.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Core Data的增删查改">
<meta name="twitter:description" content="初始化方法一创建一个iOS工程，勾选Use Core Data。
工程创建完后，XCode将为我们生成一个xcdatamodeld文件用于创建实体。我们可以在这里编辑实体，并产生托管对象类。同时，XCode也在AppDelegate.Swift中添加了一些用于支持CoreData的代码。
我在这里所用的办法是通过辅助类来设置Core Data，这样的话，你就可以将这种办法运用到自己的项目中了。这也">
    
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

    

    <script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>
</head>
<body>
<div id="container"> 
    <div id="wrap">
	

<header id="header" class="hdpage">
    
    <div id="header-outer" class="outer">
        
        <div id="header-inner" class="inner">
          <nav id="main-nav">
            <a id="main-nav-toggle" class="nav-icon"></a>
            
              <a class="main-nav-link" href="/">
                  
                  

                
                  Home
                </a>
            
              <a class="main-nav-link" href="/tags">
                  
                  

                
                  Tags
                </a>
            
              <a class="main-nav-link" href="/category">
                  
                  

                
                  Category
                </a>
            
              <a class="main-nav-link" href="/archives">
                  
                  

                
                  Archives
                </a>
            
              <a class="main-nav-link" href="http://weibo.com/71414225">
                  
                  

                
                  WeiBo
                </a>
            
              <a class="main-nav-link" href="https://github.com/dowhilenet">
                  
                  

                
                  Github
                </a>
            
          </nav>
          <nav id="sub-nav">
            
            <a id="nav-search-btn" class="nav-icon" title="Search"></a>
          </nav>
          <div id="search-form-wrap">
            <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://dowhile.net"></form>
          </div>
        </div>
    </div>
</header>

		<div class="outer">
		

    <article id="post-coredata2" class="article article-type-post" itemscope itemprop="blogPost">
      <div class="article-meta">
        
          <header class="article-header">
            
  
    <a href="/2015/06/04/coredata2/">
      <h1 class="article-title" itemprop="name">
        Core Data的增删查改
      </h1>
    </a>
  



          </header>
        

        <!--<a href="/2015/06/04/coredata2/" class="article-date">
  <time datetime="2015-06-04T06:53:06.000Z" itemprop="datePublished">2015-06-04</time>
</a>-->
        <!-- 
  <div class="article-category">
    <a class="article-category-link" href="/categories/存储/">存储</a>
  </div>
 -->
      </div>
      <div class="article-inner">
            
            
              <!--<header class="article-header">
                
  
    <a href="/2015/06/04/coredata2/">
      <h1 class="article-title" itemprop="name">
        Core Data的增删查改
      </h1>
    </a>
  



              </header>-->
            
            <div class="article-entry" itemprop="articleBody">
              <div class="page-toc">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#初始化"><span class="toc-number">1.</span> <span class="toc-text">初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#方法一"><span class="toc-number">1.1.</span> <span class="toc-text">方法一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#方法二"><span class="toc-number">1.2.</span> <span class="toc-text">方法二</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#实现CoreDataHelper类"><span class="toc-number">1.2.1.</span> <span class="toc-text">实现CoreDataHelper类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建托管对象模型"><span class="toc-number">2.</span> <span class="toc-text">创建托管对象模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#实体"><span class="toc-number">2.1.</span> <span class="toc-text">实体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实体属性"><span class="toc-number">2.2.</span> <span class="toc-text">实体属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#属性的各种设置选项"><span class="toc-number">2.3.</span> <span class="toc-text">属性的各种设置选项</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Transient"><span class="toc-number">2.3.1.</span> <span class="toc-text">Transient</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Optional"><span class="toc-number">2.3.2.</span> <span class="toc-text">Optional</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Indexed"><span class="toc-number">2.3.3.</span> <span class="toc-text">Indexed</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Validation"><span class="toc-number">2.3.4.</span> <span class="toc-text">Validation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reg-_Ex-"><span class="toc-number">2.3.5.</span> <span class="toc-text">Reg. Ex.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Default"><span class="toc-number">2.3.6.</span> <span class="toc-text">Default</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Allows_External_Storage"><span class="toc-number">2.3.7.</span> <span class="toc-text">Allows External Storage</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建NSManagedObject的子类"><span class="toc-number">3.</span> <span class="toc-text">创建NSManagedObject的子类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建托管对象"><span class="toc-number">4.</span> <span class="toc-text">创建托管对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后端SQL的可见性"><span class="toc-number">5.</span> <span class="toc-text">后端SQL的可见性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取托管对象"><span class="toc-number">6.</span> <span class="toc-text">获取托管对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对获取的请求结果进行排序"><span class="toc-number">7.</span> <span class="toc-text">对获取的请求结果进行排序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对请求的结果进行筛选"><span class="toc-number">8.</span> <span class="toc-text">对请求的结果进行筛选</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取请求模版"><span class="toc-number">9.</span> <span class="toc-text">获取请求模版</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fetching_different_result_types"><span class="toc-number">10.</span> <span class="toc-text">Fetching different result types</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除托管对象"><span class="toc-number">11.</span> <span class="toc-text">删除托管对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#托管对象模型的扩展"><span class="toc-number">12.</span> <span class="toc-text">托管对象模型的扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#未完待续"><span class="toc-number">12.1.</span> <span class="toc-text">未完待续</span></a></li></ol></li></ol>
              </div>
              
                <h2 id="初始化">初始化</h2><h3 id="方法一">方法一</h3><p>创建一个iOS工程，勾选Use Core Data。</p>
<p>工程创建完后，XCode将为我们生成一个xcdatamodeld文件用于创建实体。我们可以在这里编辑实体，并产生托管对象类。同时，XCode也在AppDelegate.Swift中添加了一些用于支持CoreData的代码。</p>
<p>我在这里所用的办法是通过辅助类来设置Core Data，这样的话，你就可以将这种办法运用到自己的项目中了。这也使得Core  Data组件变的模块化，而且易于移植。我们将通过应用程序委托来惰性地(lazily)创建CoreDataHelper类的实例。下面就来看我们的方法二</p>
<h3 id="方法二">方法二</h3><p>这种实例可用来完成下列事项：<br>1、初始化托管对象模型<br>2、根据托管对象模型来创建持久化存储区，并据此初始化持久化存储协调器<br>3、根据化持久化存储协调器来初始化托管对象上下文</p>
<p>我们先创建CoreDataHelper.Swift文件，并且将Subclass类名为CoreDataHelper。</p>
<h4 id="实现CoreDataHelper类">实现CoreDataHelper类</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">CoreData</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CoreDataHelper</span>:<span class="title">NSObject</span> </span>&#123;</span><br><span class="line">  <span class="comment">// MARK: - Core Data stack</span></span><br><span class="line">   </span><br><span class="line">    <span class="comment">// 这个目录用来存放应用程序Core Data存储文件，在当前事例中，会在应用程序的Document目录下生成名为“FoodPin.Coredata”文件。</span></span><br><span class="line">    lazy <span class="keyword">var</span> applicationDocumentsDirectory: <span class="type">NSURL</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> urls = <span class="type">NSFileManager</span>.defaultManager().<span class="type">URLsForDirectory</span>(.<span class="type">DocumentDirectory</span>, inDomains: .<span class="type">UserDomainMask</span>)</span><br><span class="line">        <span class="keyword">return</span> urls[urls.<span class="built_in">count</span>-<span class="number">1</span>] <span class="keyword">as</span>! <span class="type">NSURL</span></span><br><span class="line">        &#125;()</span><br><span class="line"><span class="comment">// 应用程序的托管对象模型。   </span></span><br><span class="line">    lazy <span class="keyword">var</span> managedObjectModel: <span class="type">NSManagedObjectModel</span> = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> modelURL = <span class="type">NSBundle</span>.mainBundle().<span class="type">URLForResource</span>(<span class="string">"FoodPin"</span>, withExtension: <span class="string">"momd"</span>)!</span><br><span class="line">        <span class="keyword">return</span> <span class="type">NSManagedObjectModel</span>(contentsOfURL: modelURL)!</span><br><span class="line">        &#125;()</span><br><span class="line">    <span class="comment">//持久化协调器</span></span><br><span class="line">    lazy <span class="keyword">var</span> persistentStoreCoordinator: <span class="type">NSPersistentStoreCoordinator</span>? = &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> coordinator: <span class="type">NSPersistentStoreCoordinator</span>? = <span class="type">NSPersistentStoreCoordinator</span>(managedObjectModel: <span class="keyword">self</span>.managedObjectModel)</span><br><span class="line">        <span class="keyword">let</span> url = <span class="keyword">self</span>.applicationDocumentsDirectory.<span class="type">URLByAppendingPathComponent</span>(<span class="string">"FoodPin.sqlite"</span>)</span><br><span class="line">        <span class="keyword">var</span> error: <span class="type">NSError</span>? = <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">var</span> failureReason = <span class="string">"There was an error creating or loading the application's saved data."</span></span><br><span class="line">        <span class="keyword">if</span> coordinator!.addPersistentStoreWithType(<span class="type">NSSQLiteStoreType</span>, configuration: <span class="literal">nil</span>, <span class="type">URL</span>: url, options: <span class="literal">nil</span>, error: &amp;error) == <span class="literal">nil</span> &#123;</span><br><span class="line">            coordinator = <span class="literal">nil</span></span><br><span class="line">            <span class="comment">// Report any error we got.</span></span><br><span class="line">            <span class="keyword">let</span> dict = <span class="type">NSMutableDictionary</span>()</span><br><span class="line">            dict[<span class="type">NSLocalizedDescriptionKey</span>] = <span class="string">"Failed to initialize the application's saved data"</span></span><br><span class="line">            dict[<span class="type">NSLocalizedFailureReasonErrorKey</span>] = failureReason</span><br><span class="line">            dict[<span class="type">NSUnderlyingErrorKey</span>] = error</span><br><span class="line">            error = <span class="type">NSError</span>(domain: <span class="string">"YOUR_ERROR_DOMAIN"</span>, code: <span class="number">9999</span>, userInfo: dict <span class="keyword">as</span> [<span class="type">NSObject</span> : <span class="type">AnyObject</span>])</span><br><span class="line">            </span><br><span class="line">            <span class="type">NSLog</span>(<span class="string">"Unresolved error <span class="subst">\(error)</span>, <span class="subst">\(error!.userInfo)</span>"</span>)</span><br><span class="line">            abort()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> coordinator</span><br><span class="line">        &#125;()</span><br><span class="line">    <span class="comment">//托管对象上下文</span></span><br><span class="line">    lazy <span class="keyword">var</span> managedObjectContext: <span class="type">NSManagedObjectContext</span>? = &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> coordinator = <span class="keyword">self</span>.persistentStoreCoordinator</span><br><span class="line">        <span class="keyword">if</span> coordinator == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> managedObjectContext = <span class="type">NSManagedObjectContext</span>()</span><br><span class="line">        managedObjectContext.persistentStoreCoordinator = coordinator</span><br><span class="line">        <span class="keyword">return</span> managedObjectContext</span><br><span class="line">        &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - Core Data Saving support</span></span><br><span class="line">    </span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">saveContext</span> <span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> moc = <span class="keyword">self</span>.managedObjectContext &#123;</span><br><span class="line">            <span class="keyword">var</span> error: <span class="type">NSError</span>? = <span class="literal">nil</span></span><br><span class="line">            <span class="keyword">if</span> moc.hasChanges &amp;&amp; !moc.save(&amp;error) &#123;</span><br><span class="line">               </span><br><span class="line">                <span class="type">NSLog</span>(<span class="string">"Unresolved error <span class="subst">\(error)</span>, <span class="subst">\(error!.userInfo)</span>"</span>)</span><br><span class="line">                abort()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我是绝对绝对不会告诉你上边的这段代码是我从<strong>AppDelegate.Swift</strong>中将有关<strong>CoreData</strong>的部分剪贴出来生成新的<strong>CoreDataHelper</strong>类的。</p>
<h2 id="创建托管对象模型">创建托管对象模型</h2><p><code>command + n</code>之后选择iOS中的Core Data里的<strong>Data Model</strong>文件，点击Next。<br>填写文件名称，默认名称是Model。点击Create之后在工程中就可以看到一个<code>.xcdatamodeld</code>为后缀的文件了。</p>
<h3 id="实体">实体</h3><p>托管对象模型由一系列实体描述对象构成，这种对象就叫做实体。实体用来创建<strong>托管对象</strong>，有了<strong>托管对象</strong>之后我们可以用<strong>Swift</strong>代码来操作其中的数据了。</p>
<p>托管对象模型可以拥有一个或者多个实体，每个应用程序的实体数量会有所差别。在制作托管对象之前，首先要把每一个实体设计好。实体的设计与传统的数据库中数据表的设计是相似的。</p>
<p>实体的属性必须有特定的数据类型，如果想从实体中创建托管对象，那么我们通常会根据实体来创建<strong>NSManagedObject</strong>的子类，但这并不是强制性的。采用<strong>NSManagedObject</strong>的子类确实有好处，比如说可以在托管对象后面使用“点符号”来访问相关属性，这样可以让代码便于阅读。</p>
<p>按照下面的步骤来添加一个实体：</p>
<p>1、选定<strong>Model.xcdatamodeld</strong><br>2、点击<strong>Add Entity</strong><br>3、把实体的名称改为<strong>Entity</strong></p>
<h3 id="实体属性">实体属性</h3><p><img src="http://7u2j0x.com1.z0.glb.clouddn.com/QQ20150604-1@2x.png" alt="实体属性"><br>选择适合的属性值在你的属性名称后边。</p>
<h3 id="属性的各种设置选项">属性的各种设置选项</h3><p><img src="http://7u2j0x.com1.z0.glb.clouddn.com/QQ20150604-2@2x.png" alt="属性的各种设置选项"></p>
<h4 id="Transient"><strong>Transient</strong></h4><p>如果在<strong>Properties</strong>中勾选了这一项，那么该属性就不会写入持久化存储区了。“不写入持久化存储区”听上去有些奇怪，但是有时，只需要吧特性留在托管对象上下文里面就行了。比方说，你需要计算某个临时的值，而这种值就可以放在<strong>transient</strong>特性中。</p>
<h4 id="Optional"><strong>Optional</strong></h4><p>Optional特性并不一定要有值。所有的特性在刚建出来的时候都是<strong>Optional</strong>特性。如果某一个不是<strong>Optiona</strong>特性，那么在把这非<strong>Optional</strong>特性放回存储区的时候，它必须具备有效的值才行。</p>
<h4 id="Indexed"><strong>Indexed</strong></h4><p>系统会优化<strong>Indexed</strong>特性以提升搜索效率，但代价是要在底层的持久化存储区占用额外的空间。这些额外的空间的大小要根据待索引的数据量来定。如果不打算搜索某个属性，那么就不要勾选<strong>Indexed</strong>，这样可以节省一些空间。</p>
<h4 id="Validation"><strong>Validation</strong></h4><p>你可以使用<strong>Validation</strong>中的各个选项来阻止不合理的数据进入持久化存储区。每一种数值型的属性都支持相同的<strong>Validation</strong>选项，也就是可以规定其最小值和最大值。同理，对于字符串类型或者日期类型的属性来说，可以限定其字符串长度和日期范围。</p>
<h4 id="Reg-_Ex-"><strong>Reg. Ex.</strong></h4><p><strong>Reg. Ex.</strong>是<strong>Regular Expression(正则表达式)</strong>的缩写，他不仅能够限定字符串的最小长度以及最大长度，而且还能实现很多验证功能。一般来说，我们会用正则表达式来判断属性中的字符串值是不是能与某个特定的模式相匹配。匹配成功了才能将其写入持久化存储区。</p>
<h4 id="Default"><strong>Default</strong></h4><p>除了可变数据类型与二进制数据之外，其余类型的属性都可以具备默认值。</p>
<h4 id="Allows_External_Storage"><strong>Allows External Storage</strong></h4><p>开启了这个选项之后，类型为二进制数据的属性就可以把大量数据保存在持久化存储区之外了。但如果底层的持久化存储区是XML格式(iOS不支持这种格式的存储区)，那么该选项就不起作用了。</p>
<h2 id="创建NSManagedObject的子类">创建NSManagedObject的子类</h2><p>托管对象模型就位之后，我们就该根据<strong>Entity</strong>实体来创建<strong>NSManagedObject</strong>的子类了。</p>
<p>1、选中<strong>Entity</strong>实体。<br>2、点击<strong>Editor</strong>&gt;<strong>Create NSManagedObject Subclass</strong>菜单项。<br>3、确保Model被选中，然后点击Next。<br>4、多次点击下一步之后，会在项目中生成<strong>Entity.swift</strong>文件。</p>
<p>在这中间要强调的一点是，要不要勾选 <strong>Use scalar properties for primitive data types</strong>。</p>
<p>勾选上这个选项之后就是使用的是你在定义的时候使用的原始数据类型。<br>如果没有勾选的话，就会存在类型的转化，转换情况如下</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">• <span class="built_in">String</span> maps <span class="keyword">to</span> <span class="built_in">String</span></span><br><span class="line">• <span class="built_in">Integer</span> <span class="number">16</span>/<span class="number">32</span>/<span class="number">64</span>, Float, Double <span class="literal">and</span> <span class="built_in">Boolean</span> <span class="built_in">map</span> <span class="keyword">to</span> NSNumber </span><br><span class="line">• <span class="built_in">Decimal</span> maps <span class="keyword">to</span> NSDecimalNumber</span><br><span class="line">• <span class="built_in">Date</span> maps <span class="keyword">to</span> NSDate</span><br><span class="line">• Binary <span class="built_in">data</span> maps <span class="keyword">to</span> NSData</span><br><span class="line">• Transformable maps <span class="keyword">to</span> AnyObject</span><br></pre></td></tr></table></figure>
<p>自己试一下，看看勾选之后和没有勾选生成的<strong>Entity.swift</strong>文件有什么区别。</p>
<h2 id="创建托管对象">创建托管对象</h2><p>所有的事情都准备好了之后，现在可以新建一些托管对象了。</p>
<p>新对象是由<strong>NSEntityDescription</strong>按照指定的名称并根据某个特定的<strong>实体</strong>而创建出来的。除了要指定对象所依据的<strong>实体</strong>之外，还需要提供<strong>托管对象上下文</strong>，创建好的<strong>托管对象</strong>将会放在那个<strong>上下文</strong>里面。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> coredataHelper = <span class="type">CoreDataHelper</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> managedobjectcontext = coredataHelper.managedObjectContext&#123;</span><br><span class="line">            <span class="keyword">var</span> object = <span class="type">NSEntityDescription</span>.insertNewObjectForEntityForName(<span class="string">"Entity"</span>, inManagedObjectContext: managedobjectcontext) <span class="keyword">as</span>! <span class="type">Entity</span></span><br><span class="line">            object.name = <span class="string">"Hello World Core Data"</span></span><br><span class="line">            <span class="keyword">var</span> e:<span class="type">NSError</span>?</span><br><span class="line">            <span class="keyword">if</span> !managedobjectcontext.save(&amp;e) &#123;</span><br><span class="line">                <span class="built_in">println</span>(<span class="string">"okCould not save <span class="subst">\(e)</span>, <span class="subst">\(e!.userInfo)</span>"</span>) &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">println</span>(<span class="string">"数据存储成功，哦也"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h2 id="后端SQL的可见性">后端SQL的可见性</h2><p>按照下列步骤开启<strong>SQL Debug</strong>模式</p>
<p>1、点击Product&gt;Scheme&gt;Edit Scheme …<br>2、点击Run Grocery Dude，并切换到Arguments分页。<br>3、点击Arguments Passed On Launch区域中的“+”按钮，以新增参数。<br>4、输入新参数 <code>-com.apple.CoreData.SQLDebug 3</code>,然后点击OK。</p>
<p>现在我们已经开启了第三级的SQL Debug模式，然后重新运行程序，查看控制台输出了什么。</p>
<h2 id="获取托管对象">获取托管对象</h2><p>想操作托管对象上下文中的现有数据，就必须先把它获取(fetch)出来。加入待获取的数据没有放在上下文中，那么Core Data会从底层的持久化存储区里面把它拿过来，这个过程对开发者来说是透明的。</p>
<p>要执行获取操作，就要有<strong>NSFetchRequest</strong>实例，改实例会返回<code>[AnyObject]</code>,这个数组里面的元素都是托管对象。在执行获取操作的时候<strong>NSFetchRequest</strong>会根据特定的实体，把每个托管对象都放在<code>[AnyObject]</code>这个数组里面，并且返回给调用者。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fetchRequest = <span class="type">NSFetchRequest</span>(entityName: <span class="string">"Entity"</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">var</span>  fetchObjects = managedobjectcontext.executeFetchRequest(fetchRequest, error: &amp;e) <span class="keyword">as</span>! [<span class="type">Entity</span>]</span><br><span class="line">            <span class="keyword">for</span> info <span class="keyword">in</span> fetchObjects&#123;</span><br><span class="line">                <span class="built_in">println</span>(<span class="string">"name: <span class="subst">\(info.name)</span>"</span>)</span><br><span class="line">                <span class="built_in">println</span>(<span class="string">"+++++++++++++++++++++++"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改</span></span><br><span class="line">info.name = <span class="string">"这块显卡有点冷"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> !managedobjectcontext.save(&amp;e)&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"不能保存<span class="subst">\(e!.localizedDescriptoin)</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<h2 id="对获取的请求结果进行排序">对获取的请求结果进行排序</h2><p>NSFetchRequest执行完毕之后会返回一个<code>NSArray</code>,而<code>NSArray</code>本身就支持其中的元素进行排序。我们可以给<code>NSFetchRequest</code>配置排序描述符，这样的话。<code>NSFetchRequest</code>就可以直接按特定方式获取到托管对象进行排序了。这个描述符是作为<code>NSSortDescriptor</code>的实例传给<code>NSFetchRequest</code>的。</p>
<h2 id="对请求的结果进行筛选">对请求的结果进行筛选</h2><p>有时我们并不想把与某个实体有关的全部对象都获取过来，这时可以通过谓词来筛选。我们采用<code>NSPredicate</code>实例来定义谓词，并将其传给<code>NSFetchRequest</code>实例。有了谓词之后，获取请求就会根据谓词中的标准限定获取到的托管对象的数量。</p>
<h2 id="获取请求模版">获取请求模版</h2><p>如果我们每一次获取托管对象时都要使用手工编写谓词格式确实很累人哇。幸好的是，Xcode的Data Model Designer有预定义获取请求的功能。这些可复用的模版比谓词更容易配置，而且还能减少重复代码。</p>
<p>创建获取请求模版：</p>
<ol>
<li>选中.xcdatamodeld。</li>
<li>点击Editot &gt; Add Fetch Rquest。</li>
<li>然后设置请求模版的名称。</li>
<li>点击＋按钮来配置获取请求模版。</li>
</ol>
<p>要想使用获取请求模版，需要先给托管对象模型发送消息，告诉他将要使用的模版叫做什么名字。发送完消息之后，就可以在返回的NSFetchRequest上面操作了。由于这种获取请求是根据模版创建出来的，所以我们无需通过向其发送谓词来执行筛选操作。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fetchRequest3 = managedObjectModel.fetchRequestTemplateForName(<span class="string">"Name"</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="Fetching_different_result_types">Fetching different result types</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">NSFetchRequestResultType</span> : <span class="title">OptionSetType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span>(rawValue rawValue: <span class="type">UInt</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">ManagedObjectResultType</span>: <span class="type">NSFetchRequestResultType</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">//返回  ManagedObject  这个是默认的</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">ManagedObjectIDResultType</span>: <span class="type">NSFetchRequestResultType</span> &#123; <span class="keyword">get</span>&#125;</span><br><span class="line">    <span class="comment">//返回  unique identifiers instead of full- fledged managed objects.</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">DictionaryResultType</span>: <span class="type">NSFetchRequestResultType</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">//返回 字典类型</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">CountResultType</span>: <span class="type">NSFetchRequestResultType</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 返回  Returns the count of the objects that match the fetch</span></span><br><span class="line">request.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="删除托管对象">删除托管对象</h2><p>若想删除托管对象，只需要在包含对象的上下文中调用<code>deleteObject</code>或者<code>deleteObjects</code>。然后用上下文的save方法保存更新数据库。</p>
<h2 id="托管对象模型的扩展">托管对象模型的扩展</h2><h3 id="未完待续">未完待续</h3>
              
            </div>
            <footer class="article-footer">
              <a href="/2015/06/04/coredata2/" class="article-date">
  <time datetime="2015-06-04T06:53:06.000Z" itemprop="datePublished">2015-06-04</time>
</a>
              <a data-url="http://dowhile.net/2015/06/04/coredata2/" data-id="cie2c8zz5004o7hs6zg6m7mxu" class="article-share-link">Share</a>
              
              
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CoreData/">CoreData</a></li></ul>

            </footer>
      </div>
      
        
<nav id="article-nav">
  
    <a href="/2015/06/10/coredataqianyi/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Core Data托管对象模型的迁移
        
      </div>
    </a>
  
  
    <a href="/2015/06/03/CoreData1/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">CoreData是什么</div>
    </a>
  
</nav>

      
    </article>
    <script type="text/javascript">
      window.onscroll = function(){ 
        $(function(){
          var $toc = $('.page-toc'),
              $article = $('.article-entry')
              toc_top = $toc.offset().top
              tocsub_width = $toc.children().width()
              article_height = $article.children().height()
              scroll_top = document.body.scrollTop
              screen_h = $(window).height()
              footer_top = $('.article-footer').offset().top - $(window).height()
              if(toc_top&&scroll_top&&scroll_top>toc_top&&scroll_top<footer_top){
                $toc.children().css({
                  "position": "fixed",
                  "height": (screen_h -20)+'px',
                  "overflow": "auto"
                })
                $article.css('margin-right',tocsub_width+'px')
              }else{
                $toc.children().css({
                  "position": "relative",
                  "height":'inherit',
                  "overflow": "auto"
                })
                $article.css('margin-right',0+'px')
              }
        })
      } 
    </script>








		</div>
		<footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
        <div class="left">
            &copy; 2015 这块显卡有点冷<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/jaywcjlove/hexoThemeKacper">hexoThemeKacper </a>
        </div>
        <div class="right">
            
        </div>
    </div>
  </div>
</footer>
<script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>


<script type="text/javascript">
$(function(){
  var $img = $('.article-entry img'),
      $link = $img.css({
        "display":"inline-block"
      }).parent()

  if($link.parent().is("a")){
      $img.each(function(idx,item) {
      $(this).parent().attr('href',$(this).parent().parent().attr('href'))
    })
  }
})
</script>


<script src="/js/script.js" type="text/javascript"></script>

  	</div>
	<nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/category" class="mobile-nav-link">Category</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="http://weibo.com/71414225" class="mobile-nav-link">WeiBo</a>
  
    <a href="https://github.com/dowhilenet" class="mobile-nav-link">Github</a>
  
</nav>
</div>
</body>
</html>

